# {{ cookiecutter.project_name }}

{{ cookiecutter.description }}

### Development environment
0. Install Python {{ cookiecutter.python_version }} with [pyenv](https://github.com/pyenv/pyenv)
```
pyenv install {{ cookiecutter.python_version }}
```

1. Install pre-commit
```
pip install pre-commit
```

2. Clone the repository
```
git clone git@github.com:hmrc/{{ cookiecutter.project_name }}.git
cd {{ cookiecutter.project_name }}
pre-commit install && pre-commit autoupdate
python3 -m venv venv && source venv/bin/activate  # Use any virtualenv provider you like
pip install tox
```

3. To run linters and tests
```
tox
```

4. To run formatter
```
tox -e black
```

5. If you've added dependencies to the requirements files, run tox with `-r` flag to recreate the virtualenvs:
```
tox -r
```

### Adding dependencies

- Runtime dependencies should be pinned in in `requirements.txt`. `setup.py` reads that file during installation.
- Testing dependencies should be added to `requirements-test.txt`. `tox` reads that file when installing test dependencies.

### Setting up CI with Jenkins
{%- if cookiecutter.type == "lambda" %}
Create a PR (via a fork if you lack permissions) for this file: 

https://github.com/hmrc/infrastructure-jenkins-pipelines/blob/HEAD/jobs/lambda/seed.groovy

It would cause [Infrastructure's Jenkins](https://jenkins.tools.management.tax.service.gov.uk/)
to pick up the Jenkinsfile and generate a pipeline for your lambda. 

##### Important Note _!!_
The generated Jenkinsfile include platsec's deployment buckets - please take care to 
change the Jenkinsfile to deploy to your team's appropriate buckets _!!_

Once the lambda is packaged and uploaded to S3, it can be accessed by terraform.
{%- elif cookiecutter.type == "package" %}
Create a PR (via a fork if you lack permissions) for this file (NOTE: this is the platsec 
file -- use the file appropriate for your team :smile:)

https://github.com/hmrc/build-jobs/blob/HEAD/jobs/live/platsec.groovy

and add CI jobs, for example for a repo named `request-ssh-access`:
```groovy
// request-ssh-access ci
new PythonLibraryToxJobBuilder("$TEAM", 'request-ssh-access')
        .test()
        .release()
        .build this as DslFactory

// request-ssh-access pull-request
new PythonLibraryToxPullRequestBuilder("$TEAM", 'request-ssh-access')
        .test()
        .build this as DslFactory
```
{% endif %}

### License
This code is open source software licensed under the [Apache 2.0 License]("http://www.apache.org/licenses/LICENSE-2.0.html").

_This repo was generated by [hmrc/python-cookiecutter](https://github.com/hmrc/python-cookiecutter)_
